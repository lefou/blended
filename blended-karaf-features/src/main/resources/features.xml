<?xml version="1.0" encoding="UTF-8"?>

<!--
  ~ Copyright 2014ff, WoQ - Way of Quality GmbH
  ~
  ~ Licensed under the Apache License, Version 2.0 (the "License");
  ~ you may not use this file except in compliance with the License.
  ~ You may obtain a copy of the License at
  ~
  ~     http://www.apache.org/licenses/LICENSE-2.0
  ~
  ~ Unless required by applicable law or agreed to in writing, software
  ~ distributed under the License is distributed on an "AS IS" BASIS,
  ~ WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
  ~ See the License for the specific language governing permissions and
  ~ limitations under the License.
  -->
<features name="blended-${project.version}" xmlns="http://karaf.apache.org/xmlns/features/v1.0.0">

  <repository>mvn:org.apache.camel.karaf/apache-camel/${camel.version}/xml/features</repository>
  <repository>mvn:org.apache.activemq/activemq-karaf/${activemq.version}/xml/features</repository>
  <repository>mvn:org.apache.karaf.assemblies.features/standard/${karaf.version}/xml/features</repository>
  <repository>mvn:io.hawt/hawtio-karaf/${hawtio.version}/xml/features</repository>
  <repository>mvn:org.ops4j.pax.web/pax-web-features/${pax-web.version}/xml/features</repository>

  <feature name="blended-commons" description="Blended - Commons" version="${project.version}" start-level="10" resolver="(obr)">
    <bundle>mvn:org.apache.commons/com.springsource.org.apache.commons.collections/${commons.collections.version}</bundle>
    <bundle>mvn:org.apache.commons/com.springsource.org.apache.commons.discovery/${commons.discovery.version}</bundle>
    <bundle>mvn:commons-lang/commons-lang/${commons.lang.version}</bundle>
    <bundle>mvn:commons-pool/commons-pool/${commons.pool.version}</bundle>
    <bundle>mvn:commons-net/commons-net/${commons.net.version}</bundle>
    <bundle>mvn:org.apache.commons/commons-exec/${commons.exec.version}</bundle>
    <bundle>mvn:org.apache.commons/com.springsource.org.apache.commons.io/${commons.io.version}</bundle>
    <bundle>mvn:org.apache.commons/com.springsource.org.apache.commons.codec/${commons.codec.version}</bundle>
    <bundle>mvn:org.apache.commons/com.springsource.org.apache.commons.httpclient/${commons.httpclient.version}</bundle>
    <bundle>mvn:org.apache.servicemix.bundles/org.apache.servicemix.bundles.commons-beanutils/${commons.beanutils.version}</bundle>
  </feature>

  <feature name="blended-base" description="Blended - Base bundles" version="${project.version}" resolver="(obr)" start-level="20">
    <feature version="${akka.version}">blended-akka</feature>
    <feature version="${project.version}">blended-commons</feature>
    <feature version="${karaf.version}">wrapper</feature>
    <bundle>mvn:org.apache.felix/org.apache.felix.eventadmin/${felix.event.version}</bundle>
    <bundle>mvn:org.apache.felix/org.apache.felix.fileinstall/${felix.fileinstall.version}</bundle>
    <bundle>mvn:de.woq.blended/blended-util/${blended.version}</bundle>
    <bundle>mvn:de.woq.blended/blended-container-context/${blended.version}</bundle>
    <bundle>mvn:de.woq.blended/blended-container-id/${blended.version}</bundle>
    <bundle>mvn:de.woq.blended/blended-jmx/${blended.version}</bundle>
    <!--bundle>mvn:de.woq.blended/blended-persistence/${blended.version}</bundle>
    <bundle>mvn:de.woq.blended/blended-neo4j-api/${blended.version}</bundle>
    <bundle>mvn:de.woq.blended/blended-container-registry/${blended.version}</bundle-->
  </feature>

  <feature name="blended-camel" description="Blended - Camel" version="${project.version}" resolver="(obr)">
    <feature version="${project.version}">blended-base</feature>
    <feature version="${camel.version}">camel</feature>
    <feature version="${camel.version}">camel-jms</feature>
    <feature version="${camel.version}">camel-exec</feature>
    <bundle>mvn:org.apache.camel/camel-http/${camel.version}</bundle>
    <bundle>mvn:org.apache.camel/camel-servlet/${camel.version}</bundle>
    <bundle>mvn:org.apache.camel/camel-servletlistener/${camel.version}</bundle>
    <bundle>mvn:de.woq.blended/blended-camel-utils/${blended.version}</bundle>
  </feature>

  <feature name="blended-activemq-broker" description="Blended - Active MQ support" resolver="(obr)">
    <feature version="${activemq.version}">blended-activemq-blueprint</feature>
    <feature version="${project.version}">blended-base</feature>
  </feature>

  <!-- Active MQ 5.9.0 Feature Fix : Obsolete with upcoming fix ( see https://issues.apache.org/jira/browse/AMQ-4833 ) -->

  <!-- Bundles needed if only client will be deployed in the container -->
  <feature name="blended-activemq-client" description="Blended - ActiveMQ client libraries" version="${activemq.version}" resolver="(obr)" start-level="50">
    <feature version="[3.1,4)">spring</feature>
    <bundle dependency="true">mvn:org.apache.geronimo.specs/geronimo-annotation_1.0_spec/1.1.1</bundle>
    <bundle dependency="true">mvn:org.apache.geronimo.specs/geronimo-jta_1.1_spec/1.1.1</bundle>
    <bundle dependency="true">mvn:org.apache.geronimo.specs/geronimo-jms_1.1_spec/1.1.1</bundle>
    <bundle dependency="true">mvn:org.apache.geronimo.specs/geronimo-j2ee-management_1.1_spec/1.0.1</bundle>
    <bundle dependency="true">mvn:org.jvnet.jaxb2_commons/jaxb2-basics-runtime/0.6.4</bundle>
    <bundle dependency='true'>mvn:org.apache.servicemix.bundles/org.apache.servicemix.bundles.jaxb-impl/2.2.1.1_2</bundle>
    <bundle dependency='true'>wrap:mvn:org.apache.zookeeper/zookeeper/3.4.5$Import-Package=*;resolution:=optional&amp;Export-Package=org.apache.zookeeper*;-noimport:=true&amp;overwrite=merge</bundle>
    <!-- uber osgi bundle means client is not that lean, todo: introduce client osgi bundle -->
    <bundle dependency="false">mvn:org.apache.xbean/xbean-spring/${xbean.version}</bundle>
    <bundle>mvn:org.apache.activemq/activemq-osgi/${activemq.version}</bundle>
  </feature>

  <feature name="blended-scala" description="Blended - Scala libraries" version="${scala.version}" resolver="(obr)" start-level="10" >
    <bundle>mvn:org.scala-lang/scala-library/${scala.version}.${scala.micro.version}</bundle>
    <bundle>mvn:org.scala-lang/scala-reflect/${scala.version}.${scala.micro.version}</bundle>
  </feature>

  <feature name="blended-jaxrs" description="Blended - JAXRS Extender" version="${project.version}" resolver="(obr)" start-level="50">
    <feature version="${pax-web.version}">pax-http-whiteboard</feature>

    <bundle>mvn:org.codehaus.jettison/jettison/${jettison.version}</bundle>
    <bundle>mvn:org.codehaus.jackson/jackson-core-asl/${jackson.version}</bundle>
    <bundle>mvn:org.codehaus.jackson/jackson-mapper-asl/${jackson.version}</bundle>
    <bundle>mvn:org.codehaus.jackson/jackson-jaxrs/${jackson.version}</bundle>

    <bundle>mvn:com.sun.jersey/jersey-core/${jersey.version}</bundle>
    <bundle>mvn:com.sun.jersey/jersey-json/${jersey.version}</bundle>
    <bundle>mvn:com.sun.jersey/jersey-server/${jersey.version}</bundle>
    <bundle>mvn:com.sun.jersey/jersey-servlet/${jersey.version}</bundle>
    <bundle>mvn:com.sun.jersey/jersey-client/${jersey.version}</bundle>

    <bundle>mvn:org.apache.geronimo.specs/geronimo-servlet_3.0_spec/1.0</bundle>

    <bundle>mvn:de.woq.blended/blended-jaxrs/${project.version}</bundle>
  </feature>

  <feature name="blended-hawtio" description="Blended - HawtIO bundles" version="${project.version}" resolver="(obr)" start-level="50">
    <feature version="${project.version}">blended-jaxrs</feature>

    <bundle>mvn:io.hawt/hawtio-json-schema-mbean/${hawtio.version}</bundle>
    <bundle>mvn:io.hawt/hawtio-osgi-jmx/${hawtio.version}</bundle>
    <bundle>mvn:io.hawt/hawtio-web/${hawtio.version}/war</bundle>

    <bundle>mvn:org.fusesource.insight/insight-log/${insight-log.version}</bundle>
  </feature>

  <!-- All bundles needed by the broker -->
  <feature name="blended-activemq" description="Blended - ActiveMQ broker libraries" version="${activemq.version}" resolver="(obr)" start-level="50">
    <feature version="${project.version}">blended-jaxrs</feature>
    <feature version="${scala.version}">blended-scala</feature>
    <feature version="${project.version}">blended-commons</feature>
    <feature version="${activemq.version}">blended-activemq-client</feature>
    <bundle>mvn:org.apache.activemq/activemq-karaf/${activemq.version}</bundle>
    <bundle dependency="true">mvn:org.apache.xbean/xbean-spring/${xbean.version}</bundle>
    <bundle dependency="true">mvn:org.apache.servicemix.bundles/org.apache.servicemix.bundles.velocity/${velocity.version}</bundle>
    <bundle dependency="true">mvn:org.apache.servicemix.bundles/org.apache.servicemix.bundles.jasypt/${jasypt.version}</bundle>
    <bundle dependency="true">mvn:org.apache.servicemix.specs/org.apache.servicemix.specs.stax-api-1.0/${stax.api.version}</bundle>
    <bundle dependency="true">mvn:org.apache.servicemix.bundles/org.apache.servicemix.bundles.xpp3/1.1.4c_5</bundle>
    <bundle dependency="true">mvn:joda-time/joda-time/1.6.2</bundle>
    <bundle dependency="true">mvn:org.apache.servicemix.bundles/org.apache.servicemix.bundles.xstream/1.3_3</bundle>
    <bundle dependency="true">mvn:org.apache.aries.transaction/org.apache.aries.transaction.manager/1.0.0</bundle>
    <bundle dependency="true">mvn:org.apache.geronimo.specs/geronimo-j2ee-connector_1.5_spec/2.0.0</bundle>
    <bundle dependency="true">mvn:org.apache.aries/org.apache.aries.util/${aries.blueprint.version}</bundle>
    <bundle dependency="true">mvn:org.apache.activemq/activeio-core/3.1.4</bundle>
  </feature>

  <feature name="blended-activemq-blueprint" description="Blended - ActiveMQ Blueprint support" version="${activemq.version}" resolver="(obr)" start-level="50">
    <feature version="${activemq.version}">blended-activemq</feature>
    <bundle dependency="true">mvn:org.apache.servicemix.specs/org.apache.servicemix.specs.scripting-api-1.0/1.9.0</bundle>
    <bundle dependency="true">mvn:org.apache.commons/commons-jexl/2.0.1</bundle>
    <bundle dependency="true">mvn:org.apache.xbean/xbean-blueprint/${xbean.version}</bundle>
    <bundle>mvn:org.apache.activemq/activemq-blueprint/${activemq.version}</bundle>
    <bundle>mvn:de.woq.blended/blended-activemq-brokerstarter/${project.version}</bundle>

  </feature>

  <feature name="blended-akka" description="Blended - The basic Akka bundles" version="${akka.version}" resolver="(obr)" start-level="15" >
    <feature version="${scala.version}">blended-scala</feature>
    <bundle dependency="true">mvn:com.typesafe/config/${typesafe.config.version}</bundle>
    <bundle dependency="true">mvn:com.typesafe.akka/akka-actor_${scala.version}/${akka.version}</bundle>
    <bundle dependency="true">mvn:com.typesafe.akka/akka-slf4j_${scala.version}/${akka.version}</bundle>
    <bundle>mvn:com.typesafe.akka/akka-osgi_${scala.version}/${akka.version}</bundle>
    <bundle>mvn:de.woq.blended/blended-modules/${project.version}</bundle>
    <bundle>mvn:de.woq.blended/blended-akka/${project.version}</bundle>
  </feature>

  <feature name="blended-akka-cluster" description="Blended - Bundles for Akka clustering" version="${akka.version}" resolver="(obr)" start-level="20" >
    <feature version="${akka.version}">blended-akka</feature>
    <bundle dependency="true">wrap:mvn:org.uncommons.maths/uncommons-maths/${uncommons.maths.version}</bundle>
    <bundle dependency="true">mvn:com.google.protobuf/protobuf-java/${protobuf.version}</bundle>
    <bundle dependency="true">mvn:io.netty/netty/${netty.version}</bundle>
    <bundle>mvn:com.typesafe.akka/akka-remote_${scala.version}/${akka.version}</bundle>
    <bundle>mvn:com.typesafe.akka/akka-cluster_${scala.version}/${akka.version}</bundle>
  </feature>

  <feature name="blended-akka-camel" description="Blended - Bundles for Akka-Camel integration" version="${blended.version}" resolver="(obr)" start-level="20">
    <feature version="${project.version}">blended-camel</feature>
    <feature version="${akka.version}">blended-akka</feature>
    <bundle>mvn:com.typesafe.akka/akka-camel_${scala.version}/${akka.version}</bundle>
  </feature>

  <feature name="blended-akka-spray" description="Blended - Bundles for the Spray support" version="${project.version}" resolver="(obr)" start-level="50">
    <feature version="${akka.version}">blended-akka</feature>
    <bundle>mvn:org.apache.geronimo.specs/geronimo-servlet_3.0_spec/1.0</bundle>
    <bundle>mvn:com.googlecode.concurrentlinkedhashmap/concurrentlinkedhashmap-lru/${linkedhashmap.version}/jar/woq</bundle>
    <bundle>mvn:org.jvnet.mimepull/mimepull/${mimepull.version}</bundle>
    <bundle>mvn:de.woq.blended/blended-spray-api/${blended.version}</bundle>
    <bundle>mvn:de.woq.blended/blended-spray/${blended.version}</bundle>
  </feature>

  <feature name="blended-samples" description="Sample bundles" version="${blended.version}" resolver="(obr)">
    <feature version="${blended.version}">blended-akka-camel</feature>
    <feature version="${activemq.version}">blended-activemq-blueprint</feature>
    <feature version="${blended.version}">blended-akka-spray</feature>
    <bundle>blueprint:file:etc/amq-broker.xml</bundle>
    <bundle>mvn:de.woq.blended.samples/blended-samples-spray-helloworld/${blended.version}</bundle>
    <bundle>mvn:de.woq.blended.samples/blended-samples-camel/${blended.version}</bundle>
    <bundle>mvn:de.woq.blended.samples/blended-samples-tracker/${blended.version}</bundle>
  </feature>

</features>
