<?xml version="1.0" encoding="UTF-8" standalone="no"?>

<blueprint xmlns="http://www.osgi.org/xmlns/blueprint/v1.0.0"
           xmlns:amq="http://activemq.apache.org/schema/core"
           xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
           xsi:schemaLocation="
    http://activemq.apache.org/schema/core http://activemq.apache.org/schema/core/activemq-core.xsd
">

  <bean id="startCompleter"
    class="de.woq.osgi.java.activemq.brokerstarter.ActiveMQBrokerStarter"
    init-method="init">

    <argument index="0">
      <amq:broker brokerName="sib" useJmx="true" persistent="true">

        <amq:managementContext>
          <amq:managementContext createConnector="false" />
        </amq:managementContext>

        <amq:persistenceAdapter>
          <amq:kahaDB directory="amq/kahadb" indexWriteBatchSize="1000" enableIndexWriteAsync="true" enableJournalDiskSyncs="false" />
        </amq:persistenceAdapter>

        <amq:transportConnectors>
          <amq:transportConnector name="openWire" uri="tcp://0.0.0.0:61616" />
        </amq:transportConnectors>

      </amq:broker>
    </argument>

    <argument index="1">
      <reference interface="de.woq.osgi.java.startcompletion.StartCompletionService" timeout="1000" />
    </argument>

    <argument index="2" value="activemq.broker" />
  </bean>


  <bean id="connectionFactory" class="org.apache.activemq.ActiveMQConnectionFactory">
    <property name="brokerURL" value="tcp://localhost:61616" />
  </bean>

  <service interface="javax.jms.ConnectionFactory" ref="connectionFactory">
    <service-properties>
      <entry key="provider" value="activemq" />
    </service-properties>
  </service>

</blueprint>
